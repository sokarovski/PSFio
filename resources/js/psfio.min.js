function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}if(!PS)var PS={};PS.PSFio=function(){function e(t){_classCallCheck(this,e),t=t||{},this.inline=!!t.inline,this.buildWith=t.builder,this.allowMultipleUploads=t.multiple!==!1,this.loadedDir="",this.currentFolder="",this.fileList=null,this.callback=t.callback,this.destroyOnPick=t.destroyOnPick,this.parseConnector(t.connector),this.build(t),this.buildElements(),this.findDefaultRenderer(t.renderer),this.refresh()}return e.prototype.parseConnector=function(e){var t;e?this.connector=e:(t=$('meta[name="psfio-connector"]').attr("content"))?this.connector=t:this.connector="/psfio",this.connector&&"/"!=this.connector.substr(-1)&&(this.connector+="/")},e.prototype.setCallback=function(e){this.callback=e},e.prototype.findDefaultRenderer=function(e){var t;e?this.setRenderer(e):(t=localStorage.getItem("psfio-renderer"))?this.setRenderer(PS.PSFio.Renderers[t]):this.setRenderer(PS.PSFio.Renderers.Grid)},e.prototype.setRenderer=function(e){this.renderer&&this.renderer.clear(this.fileList),this.builder.pane.empty(),this.renderer=e,this.fileList=this.renderer.prepare(this.builder.pane),this.renderersGroup.find(".active").removeClass("active"),this.renderersGroup.find("*[data-id="+e.getIdentifier()+"]").addClass("active"),this.render()},e.prototype.build=function(e){var t=this.buildWith||this.inline?PS.PSFio.Builders.Inline:PS.PSFio.Builders.Popup;this.builder=new t(e)},e.prototype.buildElements=function(){this.buildNewFolderButton(),this.buildUploadButton(),this.buildRenderersButtons()},e.prototype.buildUploadButton=function(){this.builder.buttons.append(document.createTextNode(" "));var e=jQuery('<div class="btn btn-xs btn-default"><i class="fa fa-upload"></i> Upload File</div>');this.builder.buttons.append(e),this.buildUpload(e)},e.prototype.buildUpload=function(e){var t=jQuery('<input type="file" name="uploads[]" />');t.on("change",this.handleUpload.bind(this,e)),this.allowMultipleUploads&&t.attr("multiple","");var i=e.find(".psfio-uploadholder");0==i.length&&(i=jQuery('<div class="psfio-uploadholder"></div>'),e.css("position","relative"),e.append(i)),i.empty().append(t)},e.prototype.handleUpload=function(e){var t=this.getFormDataFromUpload(e);this.uploadFiles(t),this.buildUpload(e)},e.prototype.getFormDataFromUpload=function(e){var t=jQuery("<form></form>"),i=jQuery('<input type="text" name="folder" />').val(this.loadedDir);return t.append(e.find("input[type=file]")).append(i),new FormData(t[0])},e.prototype.buildNewFolderButton=function(){var e=jQuery('<button class="btn btn-xs btn-default"><i class="fa fa-plus"></i>  New Folder</button>');e.on("click",this.makeNewFolder.bind(this)),this.builder.buttons.append(e)},e.prototype.makeNewFolder=function(){var e=prompt("New folder name:");e&&this.newFolder(e)},e.prototype.buildRenderersButtons=function(){var e=jQuery('<div class="btn-group"></div>');this.renderersGroup=e;var t=(jQuery('<btn class="btn btn-xs btn-default"><i class="fa fa-th-list"></i></btn>'),0);for(var i in PS.PSFio.Renderers){var n=PS.PSFio.Renderers[i];if(n.getIcon&&n.getIdentifier){var o=jQuery('<btn class="btn btn-xs btn-default" ></btn>');o.attr("data-id",n.getIdentifier()),o.on("click",this.pickRenderer.bind(this,n)),jQuery('<i class="fa fa-th"></i>').addClass(n.getIcon()).appendTo(o),e.append(o),t++}}t>0&&(this.builder.buttons.append(document.createTextNode(" ")),this.builder.buttons.append(e))},e.prototype.pickRenderer=function(e){localStorage.setItem("psfio-renderer",e.getIdentifier()),this.setRenderer(e)},e.prototype.goToFolder=function(e){this.loadedDir=e,this.refresh()},e.prototype.refresh=function(){this.files(this.loadedDir)},e.prototype.files=function(e){this.request("files",{},this.onFilesSuccess.bind(this),this.onFilesError.bind(this))},e.prototype.onFilesSuccess=function(e){this.parseFiles(e)},e.prototype.onFilesError=function(){},e.prototype.rename=function(e,t){this.request("rename",{file:e,newName:t},this.onRenameSuccess.bind(this),this.onRenameError.bind(this))},e.prototype.onRenameSuccess=function(e){this.parseFiles(e)},e.prototype.onRenameError=function(){},e.prototype.deleteItem=function(e){this.request("delete",{files:e},this.onDeleteItemSuccess.bind(this),this.onDeleteItemError.bind(this))},e.prototype.onDeleteItemSuccess=function(e){this.parseFiles(e)},e.prototype.onDeleteItemError=function(){},e.prototype.newFolder=function(e){this.request("newFolder",{folderName:e},this.onNewFolderSuccess.bind(this),this.onNewFolderError.bind(this))},e.prototype.onNewFolderSuccess=function(e){this.parseFiles(e)},e.prototype.onNewFolderError=function(){},e.prototype.uploadFiles=function(e){jQuery.ajax(this.connector+"upload",{type:"POST",data:e,dataType:"json",success:this.onUploadFilesSuccess.bind(this),error:this.onUploadFilesError.bind(this),processData:!1,contentType:!1})},e.prototype.onUploadFilesSuccess=function(e){this.parseFiles(e)},e.prototype.onUploadFilesError=function(){},e.prototype.request=function(e,t,i,n){t=t||{},t.folder=this.loadedDir,jQuery.ajax(this.connector+e,{type:"GET",data:t,dataType:"json",success:i,error:n})},e.prototype.parseFiles=function(e){this.structure=e,this.render()},e.prototype.render=function(){if(this.structure){if(this.clearPane(),""!=this.loadedDir){var e=this.renderer.getUP("UP"),t=PS.PSFio.PathHelper.getParentFolder(this.loadedDir);e.on("dblclick",this.goToFolder.bind(this,t)),this.appendElement(e)}for(var i=0;i<this.structure.folders.length;i++){var n=this.structure.folders[i],o=this.renderer.getFolder(n);this.consumeFolderElement(o,n)}for(var i=0;i<this.structure.files.length;i++){var r=this.structure.files[i],s=this.renderer.getFile(r);this.consumeFileElement(s,r)}}},e.prototype.consumeFileElement=function(e,t){this.appendElement(e),this.armFileElement(e,t)},e.prototype.consumeFolderElement=function(e,t,i){this.appendElement(e),this.armFolderElement(e,t)},e.prototype.appendElement=function(e){this.fileList.append(e)},e.prototype.clearPane=function(){this.renderer.clear(this.fileList)},e.prototype.armFileElement=function(e,t){this.armMutual(e,t),e.on("dblclick",this.pickFile.bind(this,t))},e.prototype.armFolderElement=function(e,t){this.armMutual(e,t),e.on("dblclick",this.goToItem.bind(this,t))},e.prototype.armMutual=function(e,t){e.find(".psfio-remove").on("click",this.deleteItemConfirm.bind(this,t)),e.find(".psfio-rename").on("click",this.renameItemPrompt.bind(this,t))},e.prototype.pickFile=function(e){this.callback&&this.callback([e]),this.destroyOnPick?this.destroy():this.hide()},e.prototype.goToItem=function(e){this.goToFolder(e)},e.prototype.renameItemPrompt=function(e){var t=prompt("Rename file",e);t&&this.rename(e,t)},e.prototype.deleteItemConfirm=function(e){var t=confirm("Are you sure you want to delete this file");t&&this.deleteItem([e])},e.prototype.reset=function(){this.clearPane(),this.goToFolder("")},e.prototype.hide=function(){this.builder&&this.builder.hide()},e.prototype.show=function(){this.builder&&this.builder.show()},e.prototype.destroy=function(){this.hide(),this.builder.clean(),this.builder=null,this.renderer.clean(),this.renderer=null,this.structure=null},e.getShared=function(){return this.sharedInstance||(this.sharedInstance=new this({show:!1})),this.sharedInstance},e}(),PS.PSFio.Builders={},PS.PSFio.FileHelper={getFaIconForFile:function(e){var t=PS.PSFio.PathHelper.getFileParts(e).extension;switch(t=t.toLowerCase()){case"jpg":case"png":case"gif":case"jpeg":return!0;case"xls":case"xlsx":return"fa-file-excel-o";case"pdf":return"fa-file-pdf-o";case"doc":case"docx":case"rtf":case"txt":return"fa-file-word-o";case"zip":case"bz":case"gz":case"tar":return"fa-file-zip-o";case"mpeg4":case"mov":case"mp4":return"fa-file-movie-o";case"mp3":case"aiff":return"fa-file-audio-o";case"html":case"css":case"less":case"sass":case"js":case"php":return"fa-file-code-o";default:return"fa-file-o"}}},PS.PSFio.PathHelper={getParentFolder:function(e){if(!e)return"";"/"==e.substr(-1)&&(e=e.substr(0,e.length-1));var t=e.split("/");return t.pop(),t.join("/")},getFileParts:function(e){var t="",i="";if(e){var n=e.split("/"),o=n.pop(),r=o.split(".");t=r.pop(),i=r.join(".")}return{extension:t,name:i}}},PS.PSFio.Renderers={},PS.PSFio.Widgets={},PS.PSFio.Builders.Inline=function(){function e(t){_classCallCheck(this,e),t=t||{},this.buttons=t.appendButtonsTo,this.appendTo=jQuery(t.appendTo),console.log(t),this.build()}return e.prototype.build=function(){console.log(this.appendTo),this.element=jQuery('<div class="psfio psfio-inline"></div>').appendTo(this.appendTo),this.buttons||(this.buttons=jQuery('<div class="psfio-buttons"></div>').appendTo(this.element)),this.pane=jQuery('<div class="psfio-pane"></div>').appendTo(this.element)},e.prototype.clean=function(){this.element.remove()},e}(),PS.PSFio.Builders.Popup=function(){function e(t){_classCallCheck(this,e),t=t||{},this.appendTo=t.appendTo?jQuery(t.appendTo):"body",this.closeOnEscape=t.closeOnEscape!==!1,this.shouldShow=t.show!==!1,this.build(t)}return e.prototype.build=function(){var e='<div class="modal fade psfio" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="psfio-buttons"></div></div><div class="modal-body"><div class="psfio-pane"></div></div></div></div></div>',t=jQuery(e);t.find(".modal-dialog").css("height","85%"),t.find(".modal-content").css("height","100%"),t.appendTo(this.appendTo),t.modal({keyboard:this.closeOnEscape,show:this.shouldShow}),this.modal=t,this.buttons=t.find(".psfio-buttons"),this.pane=t.find(".psfio-pane")},e.prototype.clean=function(){this.modal.remove(),this.buttons=null,this.pane=null,this.appendTo=null},e.prototype.show=function(){this.modal.modal("show")},e.prototype.hide=function(){this.modal.modal("hide")},e}(),PS.PSFio.Renderers.Grid={getFile:function(e){var t=this.getMutual(e);t.element.addClass("ps-fio-grid-item-folder");var i=PS.PSFio.FileHelper.getFaIconForFile(e);return i!==!0&&jQuery('<i class="fa"></i>').addClass(i).appendTo(t.image),t.element},getFolder:function(e){var t=this.getMutual(e);return t.element.addClass("ps-fio-grid-item-folder"),t.image.append('<i class="fa fa-folder"></i>'),t.element},getUP:function(e){var t=this.getCol();return t.name.text(e),t.element.addClass("ps-fio-grid-item-back"),t.image.append('<i class="fa fa-level-up"></i>'),t.element},getMutual:function(e){var t=this.getCol(),i=jQuery('<a href="javascript:;" class="btn btn-xs btn-danger psfio-remove"><i class="fa fa-trash"></i></a>'),n=jQuery('<a href="javascript:;" class="btn btn-xs btn-default psfio-rename"><i class="fa fa-edit"></i></a>');return t.btnGroup.append(n).append(i),t.name.text(e),t},getCol:function(){var e=jQuery('<div class="psfio-grid-item"></div>'),t=jQuery('<div class="psfio-grid-item-inner"></div>'),i=jQuery('<p class="psfio-name"></p>'),n=jQuery('<div class="psfio-grid-item-image-sizer"></div>'),o=jQuery('<div class="psfio-grid-item-image"></div>'),r=jQuery('<div class="btn-group"></div>');return e.append(t),t.append(n).append(i),n.append(o),t.append(r),{element:e,name:i,inner:t,image:o,btnGroup:r}},prepare:function(e){var t=jQuery('<div class="psfio-grid-list"></div>');return e.append(t),t.on("mousedown",function(e){e.preventDefault()}),t},clear:function(e){e.empty()},getIcon:function(){return"fa-th"},getIdentifier:function(){return"Grid"}},PS.PSFio.Renderers.Table={getFile:function(e){var t=this.getMutual(e);t.element.addClass("ps-fio-table-item-folder");var i=PS.PSFio.FileHelper.getFaIconForFile(e);return i!==!0&&jQuery('<i class="fa"></i>').addClass(i).appendTo(t.icon),t.element},getFolder:function(e){var t=this.getMutual(e);return t.element.addClass("ps-fio-table-item-folder"),t.icon.append('<i class="fa fa-folder"></i>'),t.element},getUP:function(e){var t=this.getRow();return t.name.text(e),t.element.addClass("active ps-fio-table-item-back"),t.icon.append('<i class="fa fa-level-up"></i>'),t.element},getMutual:function(e){var t=this.getRow(),i=jQuery('<a href="javascript:;" class="btn btn-xs btn-danger psfio-remove"><i class="fa fa-trash"></i></a>'),n=jQuery('<a href="javascript:;" class="btn btn-xs btn-default psfio-rename"><i class="fa fa-edit"></i></a>');return t.btnGroup.append(n).append(i),t.name.text(e),t},getRow:function(){var e=jQuery("<tr></tr>"),t=jQuery('<div class="btn-group"></div>');return{element:e,btnGroup:t,icon:jQuery("<td></td>").appendTo(e),name:jQuery('<td class="col-xs-6"></td>').appendTo(e),size:jQuery('<td class="col-xs-1"></td>').appendTo(e),dateCreated:jQuery('<td class="col-xs-2"></td>').appendTo(e),dateModified:jQuery('<td class="col-xs-2"></td>').appendTo(e),actions:jQuery('<td class="col-xs-1"></td>').appendTo(e).append(t)}},prepare:function(e){var t=jQuery('<table class="table table-hover table-condensed"></table>'),i=jQuery("<thead></thead>"),n=jQuery("<tbody></tbody>"),o=jQuery("<tr></tr>");return this.createHeadColumn(o,""),this.createHeadColumn(o,"Name"),this.createHeadColumn(o,"Size"),this.createHeadColumn(o,"Date created"),this.createHeadColumn(o,"Date updated"),this.createHeadColumn(o,"Actions"),i.append(o),t.append(i).append(n),e.append(t),t.on("mousedown",function(e){e.preventDefault()}),n},createHeadColumn:function(e,t){jQuery("<th></th>").text(t).appendTo(e)},clear:function(e){e.empty()},getIcon:function(){return"fa-th-list"},getIdentifier:function(){return"Table"}},function(e,t){e.fn[t]=function(i){var n=e(this);if(!n.length)return n;var o=e(this).eq(0),r=o.data(t);return r&&r[i]&&"function"==typeof r[i]?r[i](Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void(r?e.error("Method "+i+" does not exist."):e.error("Instance not created yet: "+i)):(i=i||{},i.inline=!0,i.appendTo=o,r=new PS.PSFio(i),o.data(t,r),n)},e(document).ready(function(){for(var e=jQuery('*[data-psfio="file-browser"]'),i=0;i<e.length;i++)e.eq(i)[t]()})}(jQuery,"PSFFioFileBrowser"),function(e,t){e.fn[t]=function(i){if(!e(this).length)return e(this);var n=e(this).data(t);return n&&n[i]&&"function"==typeof n[i]?n[i](Array.prototype.slice.call(arguments,1)):"object"!=typeof i&&i?void(n?e.error("Method "+i+" does not exist."):e.error("Instance not created yet: "+i)):(n=new PS.PSFio.Widgets.Upload(e(this),i),e(this).data(t,n),e(this))},e(document).ready(function(){jQuery("input[data-psfio]")[t]()})}(jQuery,"PSFioUpload"),PS.PSFio.Widgets.Upload=function(){function e(t,i){_classCallCheck(this,e),this.arm(t)}return e.prototype.arm=function(e){for(var t=0;t<e.length;t++){var i=e.eq(t);this.build(i)}},e.prototype.getTemplate=function(e){},e.prototype.browse=function(e){var t=PS.PSFio.getShared();t.setCallback(this.onPick.bind(this,e)),t.show()},e.prototype.onPick=function(e,t,i){if(i.length>0){var n=i[0];e.find("input").val(n),e.find("img").show().attr("src",n),e.find("default").hide()}},e.prototype.clear=function(e,t){e.find("input").val(""),e.find("img").hide(),e.find("default").show()},e}();
//# sourceMappingURL=psfio.min.js.map
